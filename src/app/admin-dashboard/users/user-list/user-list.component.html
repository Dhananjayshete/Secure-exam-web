<div class="main-container">

    <div class="header-area">
        <h1 class="page-title">
            {{ pageType === 'admin' ? 'Staff' : (pageType === 'teacher' ? 'Teacher' : 'Student') }} Directory
        </h1>

        <!-- Search Bar -->
        <div class="glass-search">
            <i class="fa-solid fa-magnifying-glass text-gray-400"></i>
            <input type="text" [(ngModel)]="searchTerm" placeholder="Search by Name or ID...">
        </div>
    </div>

    <!-- CARD GRID -->
    <div class="cards-grid">
        <div class="id-card" *ngFor="let user of filteredUsers" (click)="openModal(user)">
            <img [src]="user.photo" class="card-photo">
            <div class="card-name">{{ user.name }}</div>
            <div class="card-id">ID: {{ user.id }}</div>

            <div class="card-details">
                <div class="card-row">
                    <span>{{ pageType === 'admin' ? 'Role' : 'Batch' }}</span>
                    <span>{{ user.batch }}</span>
                </div>
                <div class="card-row">
                    <span>Dept</span>
                    <span>{{ user.dept }}</span>
                </div>
                <div class="card-row">
                    <span>Status</span>
                    <span
                        [ngClass]="{'text-green-600': user.status === 'Active', 'text-red-600': user.status === 'Blocked'}"
                        class="font-bold">
                        {{ user.status }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- DETAIL POPUP MODAL -->
    <div class="modal-overlay" *ngIf="isModalOpen" (click)="closeModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <!-- Left Side -->
            <div class="modal-left">
                <img [src]="selectedUser.photo" class="modal-photo">
                <h2 class="text-xl font-bold text-gray-800 text-center">{{ selectedUser.name }}</h2>
                <span class="text-sm text-gray-500 mb-4 bg-gray-100 px-3 py-1 rounded-full">ID: {{ selectedUser.id
                    }}</span>
            </div>

            <!-- Right Side -->
            <div class="modal-right">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-lg font-bold text-indigo-600">Profile Details</h3>
                    <button (click)="closeModal()" class="text-gray-400 hover:text-red-500"><i
                            class="fa-solid fa-xmark text-xl"></i></button>
                </div>
                <div class="space-y-4 text-sm">
                    <p class="flex justify-between border-b pb-2"><span class="text-gray-500">Email</span> <span
                            class="font-medium">{{ selectedUser.email }}</span></p>
                    <p class="flex justify-between border-b pb-2"><span class="text-gray-500">Dept</span> <span
                            class="font-medium">{{ selectedUser.dept }}</span></p>
                    <p class="flex justify-between border-b pb-2"><span class="text-gray-500">Role</span> <span
                            class="font-medium">{{ selectedUser.role | titlecase }}</span></p>

                    <div class="mt-6 pt-4 border-t border-gray-100">
                        <h4 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">Account Management
                        </h4>
                        <div class="flex gap-2 mb-3">
                            <button class="flex-1 btn-sm"
                                [ngClass]="selectedUser.status === 'Active' ? 'bg-green-100 text-green-700' : 'bg-gray-100'"
                                (click)="updateStatus('Active')">Active</button>
                            <button class="flex-1 btn-sm"
                                [ngClass]="selectedUser.status === 'Blocked' ? 'bg-red-100 text-red-700' : 'bg-gray-100'"
                                (click)="updateStatus('Blocked')">Block</button>
                        </div>
                        <div class="flex flex-col gap-2">
                            <label class="text-xs text-gray-500">Change Role</label>
                            <div class="flex gap-2">
                                <button class="flex-1 btn-sm bg-gray-100"
                                    [class.bg-indigo-100]="selectedUser.role === 'student'"
                                    (click)="changeRole('student')">Student</button>
                                <button class="flex-1 btn-sm bg-gray-100"
                                    [class.bg-indigo-100]="selectedUser.role === 'teacher'"
                                    (click)="changeRole('teacher')">Teacher</button>
                                <button class="flex-1 btn-sm bg-gray-100"
                                    [class.bg-indigo-100]="selectedUser.role === 'admin'"
                                    (click)="changeRole('admin')">Admin</button>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 pt-4 border-t border-gray-100">
                        <h4 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-3">Security</h4>
                        <div class="flex gap-2">
                            <input type="text" [(ngModel)]="newPasswordForReset" placeholder="New Password"
                                class="flex-1 border rounded px-2 py-1 text-xs">
                            <button class="bg-red-500 text-white px-3 py-1 rounded text-xs" (click)="resetPassword()"
                                [disabled]="!newPasswordForReset || isActionLoading">Reset</button>
                        </div>
                    </div>

                    <div class="mt-8 flex gap-3">
                        <button class="flex-1 bg-indigo-600 text-white py-2 rounded-lg"
                            [disabled]="isActionLoading">View Exam History</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>