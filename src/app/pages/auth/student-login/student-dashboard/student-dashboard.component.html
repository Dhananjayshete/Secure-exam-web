<div class="dashboard-container">

    <!-- 1. LEFT SIDEBAR MENU -->
    <aside class="sidebar">
        <div class="brand">
            <i class="fa-solid fa-graduation-cap"></i> Secure<span>Take</span>
        </div>

        <div class="nav-title">Menu</div>

        <a class="nav-item" [class.active]="currentView === 'dashboard'" (click)="switchView('dashboard')">
            <i class="fa-solid fa-house"></i> Dashboard
        </a>
        <a class="nav-item" [class.active]="currentView === 'upcoming'" (click)="switchView('upcoming')">
            <i class="fa-solid fa-calendar-check"></i> Upcoming Exams
        </a>
        <a class="nav-item" [class.active]="currentView === 'history'" (click)="switchView('history')">
            <i class="fa-solid fa-clock-rotate-left"></i> Exam History
        </a>
        <a class="nav-item" [class.active]="currentView === 'results'" (click)="switchView('results')">
            <i class="fa-solid fa-trophy"></i> Results
        </a>
        <a class="nav-item" [class.active]="currentView === 'admit'" (click)="switchView('admit')">
            <i class="fa-solid fa-id-card"></i> Admit Card
        </a>

        <div class="nav-title">Settings</div>

        <a class="nav-item" [class.active]="currentView === 'profile'" (click)="switchView('profile')">
            <i class="fa-solid fa-user"></i> Profile
        </a>
        <a class="nav-item" [class.active]="currentView === 'password'" (click)="switchView('password')">
            <i class="fa-solid fa-key"></i> Change Password
        </a>
        <a class="nav-item" [class.active]="currentView === 'support'" (click)="switchView('support')">
            <i class="fa-solid fa-headset"></i> Support
        </a>

        <div class="motivation-card">
            <h4>Focus Mode üéØ</h4>
            <p>You have an exam in 2 days.</p>
        </div>
    </aside>

    <!-- 2. MAIN CONTENT AREA -->
    <div class="main-wrapper">

        <!-- Header -->
        <header class="top-bar">
            <div class="date-badge"><i class="fa-regular fa-calendar"></i> Academic Portal</div>

            <div class="actions-right">
                <i class="fa-regular fa-bell notification-icon"></i>
                <div class="user-pill" (click)="switchView('profile')">
                    <div class="user-info">
                        <div class="name">{{ studentProfile.name }}</div>
                        <div class="role">Student</div>
                    </div>
                    <div class="avatar"><img [src]="studentProfile.avatar" alt="User"></div>
                </div>
                <i class="fa-solid fa-right-from-bracket logout-btn" (click)="logout()"></i>
            </div>
        </header>

        <div class="content">

            <!-- A. DASHBOARD OVERVIEW -->
            <div *ngIf="currentView === 'dashboard'" class="view-section fade-in">
                <div class="hero-banner">
                    <div class="hero-text">
                        <h1>Hello, {{ studentProfile.name }}!</h1>
                        <p>Track your progress and upcoming schedules.</p>
                    </div>
                    <img src="https://cdn-icons-png.flaticon.com/512/7466/7466140.png" class="hero-img">
                </div>

                <!-- Cards Section -->
                <div class="stats-row">
                    <div class="stat-card">
                        <div class="icon-circle orange"><i class="fa-solid fa-list"></i></div>
                        <div>
                            <h3>{{ stats.total }}</h3><span>Total Exams</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="icon-circle blue"><i class="fa-solid fa-calendar-day"></i></div>
                        <div>
                            <h3>{{ stats.upcoming }}</h3><span>Upcoming</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="icon-circle green"><i class="fa-solid fa-check-circle"></i></div>
                        <div>
                            <h3>{{ stats.completed }}</h3><span>Completed</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="icon-circle purple"><i class="fa-solid fa-chart-line"></i></div>
                        <div>
                            <h3>{{ stats.latestScore }}</h3><span>Latest Result</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- B. UPCOMING EXAMS PAGE -->
            <div *ngIf="currentView === 'upcoming'" class="view-section fade-in">
                <h2 class="page-title">Upcoming Exams</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Exam Name</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Duration</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let exam of upcomingExams">
                                <td><strong>{{ exam.name }}</strong></td>
                                <td>{{ exam.date }}</td>
                                <td>{{ exam.time }}</td>
                                <td>{{ exam.duration }}</td>
                                <td><span class="status-badge"
                                        [ngClass]="{'ready': exam.status === 'Ready', 'locked': exam.status === 'Locked'}">{{
                                        exam.status }}</span></td>
                                <td>
                                    <button class="btn btn-sm"
                                        [ngClass]="exam.status === 'Ready' ? 'btn-primary' : 'btn-disabled'"
                                        (click)="startExam(exam)">
                                        Start Exam
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- C. EXAM HISTORY PAGE -->
            <div *ngIf="currentView === 'history'" class="view-section fade-in">
                <h2 class="page-title">Exam History</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Exam Name</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let exam of examHistory">
                                <td>{{ exam.name }}</td>
                                <td>{{ exam.date }}</td>
                                <td><span class="status-pass">Completed</span></td>
                                <td><button class="btn btn-sm btn-outline">View Attempt</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- D. RESULTS PAGE -->
            <div *ngIf="currentView === 'results'" class="view-section fade-in">
                <h2 class="page-title">Results & Scorecards</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Exam</th>
                                <th>Score</th>
                                <th>Result</th>
                                <th>Download</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let res of results">
                                <td><strong>{{ res.exam }}</strong></td>
                                <td>{{ res.score }}</td>
                                <td><span class="status-pass">{{ res.grade }}</span></td>
                                <td><button class="btn btn-sm btn-primary">Download PDF</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- E. ADMIT CARD SECTION -->
            <div *ngIf="currentView === 'admit'" class="view-section fade-in">
                <div class="admit-card-modern">
                    <div class="admit-top">
                        <h2>SecureTake University</h2>
                        <p>ADMIT CARD 2024</p>
                    </div>
                    <div class="admit-body">
                        <div class="info-group"><label>Name</label>
                            <div>{{ studentProfile.name }}</div>
                        </div>
                        <div class="info-group"><label>Roll No</label>
                            <div>{{ studentProfile.rollNo }}</div>
                        </div>
                        <div class="info-group"><label>Center</label>
                            <div>Online (Home)</div>
                        </div>
                        <div class="info-group"><label>Timing</label>
                            <div>10:00 AM</div>
                        </div>
                    </div>
                    <button class="btn btn-primary full-width" onclick="window.print()">Download Admit Card</button>
                </div>
            </div>

            <!-- F. PROFILE PAGE -->
            <div *ngIf="currentView === 'profile'" class="view-section fade-in">
                <h2 class="page-title">My Profile</h2>
                <div class="table-container compact-form">
                    <div class="profile-header">
                        <img [src]="studentProfile.avatar" class="profile-pic-lg">
                        <span>Upload Photo</span>
                    </div>
                    <label>Full Name</label><input type="text" [(ngModel)]="studentProfile.name">
                    <label>Email</label><input type="text" [value]="studentProfile.email" disabled>
                    <label>Phone</label><input type="text" [(ngModel)]="studentProfile.phone">
                    <button class="btn btn-primary full-width">Update Profile</button>
                </div>
            </div>

            <!-- G. CHANGE PASSWORD -->
            <div *ngIf="currentView === 'password'" class="view-section fade-in">
                <h2 class="page-title">Change Password</h2>
                <div class="table-container compact-form">
                    <label>Old Password</label><input type="password" [(ngModel)]="passwordForm.old">
                    <label>New Password</label><input type="password" [(ngModel)]="passwordForm.new">
                    <label>Confirm Password</label><input type="password" [(ngModel)]="passwordForm.confirm">
                    <button class="btn btn-primary full-width" (click)="updatePassword()">Update Password</button>
                </div>
            </div>

            <!-- H. SUPPORT SECTION -->
            <div *ngIf="currentView === 'support'" class="view-section fade-in">
                <h2 class="page-title">Help & Support</h2>
                <div class="table-container compact-form">
                    <label>Subject</label><input type="text" placeholder="e.g. Exam Crash"
                        [(ngModel)]="ticketForm.subject">
                    <label>Message</label><textarea rows="4" placeholder="Describe issue..."
                        [(ngModel)]="ticketForm.message"></textarea>
                    <button class="btn btn-primary full-width" (click)="submitTicket()">Submit Ticket</button>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- ==========================
     3. EXAM INTERFACE (SECURITY MODE)
     ========================== -->
<div id="exam-interface" *ngIf="isExamActive" [class.active]="isExamActive">
    <div class="exam-navbar">
        <div style="font-weight:700;">{{ activeExamTitle }}</div>
        <div class="timer-pill">{{ timerDisplay }}</div>
        <button class="btn btn-sm btn-danger" (click)="submitExam()">Submit Exam</button>
    </div>
    <div class="exam-layout">
        <!-- Question Panel -->
        <div class="question-panel">
            <div class="q-card" *ngIf="currentQuestion">
                <div class="q-meta">QUESTION {{ currentQuestionIndex + 1 }} OF {{ examQuestions.length }} ¬∑ {{
                    currentQuestion.points }} pts</div>
                <div class="q-text">{{ currentQuestion.questionText }}</div>

                <!-- MCQ Options -->
                <ng-container *ngIf="currentQuestion.questionType === 'MCQ'">
                    <label class="option-box" *ngFor="let opt of currentQuestion.options"
                        [class.selected]="getSelectedOptionId(currentQuestion.id) === opt.id"
                        (click)="selectOption(currentQuestion.id, opt.id)">
                        <input type="radio" [name]="'q_' + currentQuestion.id" [value]="opt.id"
                            [checked]="getSelectedOptionId(currentQuestion.id) === opt.id">
                        {{ opt.optionText }}
                    </label>
                </ng-container>

                <!-- Short Answer / Essay -->
                <ng-container
                    *ngIf="currentQuestion.questionType === 'short_answer' || currentQuestion.questionType === 'essay'">
                    <textarea [rows]="currentQuestion.questionType === 'essay' ? 8 : 3"
                        [value]="getTextAnswer(currentQuestion.id)"
                        (input)="setTextAnswer(currentQuestion.id, $any($event.target).value)"
                        [placeholder]="currentQuestion.questionType === 'essay' ? 'Write your essay here...' : 'Type your answer...'"
                        style="width:100%; padding:12px; border:1px solid #e2e8f0; border-radius:8px; margin-top:12px; resize:vertical; font-family:inherit;"></textarea>
                </ng-container>

                <div class="q-actions">
                    <button class="btn btn-sm btn-outline" (click)="prevQuestion()"
                        [disabled]="currentQuestionIndex === 0">Previous</button>
                    <button class="btn btn-sm btn-primary" (click)="nextQuestion()"
                        *ngIf="currentQuestionIndex < examQuestions.length - 1">Next</button>
                    <button class="btn btn-sm btn-danger" (click)="submitExam()"
                        *ngIf="currentQuestionIndex === examQuestions.length - 1">Submit Exam</button>
                </div>
            </div>
            <div *ngIf="!currentQuestion" style="text-align:center; padding:40px; color:#94a3b8;">
                No questions loaded for this exam.
            </div>
        </div>
        <!-- Sidebar (Question Palette) -->
        <div class="sidebar-right">
            <div class="cam-preview"><span class="rec">‚óè REC</span></div>
            <div class="q-palette">
                <div *ngFor="let q of examQuestions; let i = index" class="q-dot"
                    [class.current]="i === currentQuestionIndex" [class.solved]="isAnswered(q.id)"
                    (click)="goToQuestion(i)">
                    {{ i + 1 }}
                </div>
            </div>
        </div>
    </div>
</div>